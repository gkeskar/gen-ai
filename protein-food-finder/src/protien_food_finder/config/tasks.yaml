find_stores:
  description: >
    Search for grocery stores near {location} that are likely to have 
    good high-protein food options. Focus on well-known chains like 
    Trader Joe's, Whole Foods, Safeway, Costco, and local Indian grocery food 
    stores.
  expected_output: >
    Provide:
    - Store names
    - Approximate distance from {location}
    - Store type (Trader Joe's, Whole Foods, Safeway, Costco, local Indian grocery food store)

    Limit results to 3-5 most relevant stores.
  agent: store_locator

research_protein_items:
  description: >
    Research and identify high-protein (20g+ protein per serving) products available at EACH store identified for {location}.

    SEARCH STRATEGY FOR EACH STORE:
    1. Search specifically: "[Store Name] high protein products 20g"
    2. Search product categories: "[Store Name] protein powder" "[Store Name] Greek yogurt" "[Store Name] chicken breast"
    3. Look for product reviews: "[Store Name] best high protein foods site:reddit.com"
    4. Check store websites directly: "site:traderjoes.com protein" or "site:costco.com protein shake"

    DIETARY PREFERENCE FILTERS (Apply to ALL searches):
    - Match: {dietary_preferences}
    - Exclude beef and pork products
    - Prioritize chicken, fish, eggs, plant-based
    - Look for gluten-free labels
    - Avoid added sugar products
    - Include frozen and shelf-stable options

    For EACH product found, gather:
    - Exact product name (not generic descriptions)
    - Store where available
    - Protein content in grams per serving (MUST be 20g+)
    - Serving size (e.g., "1 cup", "3 oz", "1 container")
    - Price (search for "[product name] price [store]" if not found)
    - Category (dairy, plant-based, meat, seafood, supplements, whole-foods)
    - Full nutrition: calories, fat, carbs, fiber, sugar
    - Gluten-free status (YES/NO/UNKNOWN)
    - Whether contains beef or pork (important for filtering)

    MINIMUM TARGET: At least 5 products per store (aim for 7-10 if possible)

    QUALITY REQUIREMENTS:
    - Verify protein content is 20g+ per serving (not per package)
    - Confirm products are actually sold at the specified store
    - If information is incomplete, note it clearly
  expected_output: >
    A comprehensive, well-organized list of high-protein products grouped by store.

    Format as:

    ## STORE NAME 1
    1. Product Name
       - Protein: Xg per serving (serving size)
       - Price: $X.XX
       - Category: [category]
       - Nutrition: X cal, Xg fat, Xg carbs, Xg fiber, Xg sugar
       - Gluten-free: YES/NO
       - Contains beef/pork: NO
       - Notes: [any relevant details]

    [Repeat for each product and store]

    Include at minimum 5 products per store. Flag any products with incomplete data.
  agent: nutrition_researcher
  context:
    - find_stores_task

validate_products:
  description: >
    Validate ALL products from the research findings to ensure they meet requirements.

    VALIDATION CHECKLIST for EACH product:
    1. Protein content is 20g or higher per serving
    2. Matches dietary preferences: {dietary_preferences}
       - No beef or pork
       - Gluten-free preferred
       - No added sugar preferred
    3. Nutritional information is complete (protein, calories, price)
    4. Product is actually available at the specified store
    5. Serving size is clearly specified

    ACTIONS:
    - Create a "VALIDATED PRODUCTS" list with only products that pass all checks
    - Create a "FLAGGED PRODUCTS" list with products that fail any check (explain why)
    - For products with incomplete data, flag them as "NEEDS MORE INFO"
    - Calculate protein-per-dollar ratio for products with price info

    QUALITY METRICS:
    - Total validated products across all stores
    - Average protein content
    - Price range
    - Category distribution (how many dairy, plant-based, meat, etc.)
  expected_output: >
    A validation report with two sections:

    ## VALIDATED PRODUCTS (Ready for Recommendations)
    [List of products that passed all checks, organized by store]

    ## FLAGGED PRODUCTS (Issues Found)
    [List of products with issues and reasons why they were flagged]

    ## VALIDATION SUMMARY
    - Total products validated: X
    - Total products flagged: X
    - Average protein content: Xg
    - Price range: $X.XX - $X.XX
    - Category breakdown: X dairy, X plant-based, X meat/seafood, X supplements

    Only products in the VALIDATED section should be used for final recommendations.
  agent: nutrition_validator
  context:
    - research_protein_items_task

create_recommendations:
  description: >
    Create personalized high-protein food recommendations using ONLY the VALIDATED PRODUCTS
    from the validation report. Base recommendations on {dietary_preferences} and location {location}.

    RECOMMENDATION CRITERIA (in priority order):
    1. Protein content - Prioritize highest protein per serving (20g+)
    2. Dietary compliance - MUST match {dietary_preferences} (no beef/pork, gluten-free, no sugar)
    3. Value - Calculate and consider protein-per-dollar ratio
    4. Convenience - Prioritize ready-to-eat or minimal prep (frozen/shelf-stable OK)
    5. Variety - Ensure different protein sources (dairy, plant-based, seafood, eggs)
    6. Availability - Consider store proximity and accessibility

    CREATE THE FOLLOWING SECTIONS:

    1. TOP 5 RECOMMENDATIONS (Ranked)
       - For each: product name, store, protein content, price, protein-per-dollar
       - Explain WHY recommended (e.g., "highest protein", "best value", "most convenient")

    2. MOST CONVENIENT OPTIONS
       - Ready-to-eat or minimal prep items
       - Perfect for quick meals or on-the-go

    3. BEST VALUE OPTIONS
       - Highest protein-per-dollar ratio
       - Budget-friendly choices

    4. SHOPPING STRATEGY
       - List stores in visit priority order (based on product availability and proximity)
       - For each store: exact products to buy and estimated cost
       - Total estimated shopping time

    5. VARIETY ANALYSIS
       - Ensure recommendations cover different protein sources
       - Suggest rotation strategy to avoid monotony

    6. SUMMARY
       - Total protein potential from recommendations
       - Estimated weekly/monthly budget
       - Key benefits of this shopping plan
  expected_output: >
    A well-formatted markdown report containing:

    # High-Protein Food Recommendations for {location}
    
    ## Top 5 Recommendations
    (Ranked list with protein content, price, store, and why recommended)
    
    ## Most Convenient
    (Ready-to-eat or minimal prep items)
    
    ## Shopping Strategy
    (Which stores to visit and what to buy at each)

    ## Summary
    (Total protein potential, estimated budget, variety notes)
  agent: recommendation_specialist
  context:
    - find_stores_task
    - research_protein_items_task
    - validate_products_task
  output_file: output/protein_recommendations.md
